<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Animales</title>
    <link rel="stylesheet" type="text/css" href="scss/animals.css">
</head>
<body>
<header><h1>VetPlus+</h1></header>
<div id="taula"></div>
<script type="text/javascript">
    function tableToJson(table) {
        var data = [];


        var headers = [];
        for (var i=0; i<table.rows[0].cells.length; i++) {
            headers[i] = table.rows[0].cells[i].innerHTML.toLowerCase().replace(/ /gi,'');
        }
        data.push(headers);

        for (var i=1; i<table.rows.length; i++) {

            var tableRow = table.rows[i];
            var rowData = {};

            for (var j=0; j<tableRow.cells.length; j++) {

                rowData[ headers[j] ] = tableRow.cells[j].innerHTML;

            }

            data.push(rowData);
        }

        return data;
    }


    function callme(){
        var table = tableToJson($('#table-id').get(0));
        var doc = new jsPDF('l','pt','letter',true);


        $.each(table, function(i, row){
            $.each(row, function(j,cell){
                if(j=="email" | j==1){
                    doc.cell(1,10,190,20,cell,i);
                }
                else{
                    doc.cell(1,10,90,20,cell,i);
                }

            });
        });

        doc.save('VetPlus.pdf');
    }
</script>
<script type="module">
    import {getAnimals} from "./service/animalService.js";
    import {confirmar} from "./service/utils.js";
    import {getById} from "./service/animalService.js";


    (async function () {
        let i = 0;
        let animals = await getAnimals();
        let table = '<table id="table-id">';
        table += '<tr>';
        table += '<th>Nom</th>';
        table += '<th>Sexe</th>';
        table += '<th>Numero de registre</th>';
        table += '<th>Tipus</th>';
        table += '<th>Editar</th>';
        table += '<th>Borrar</th>';
        table += '</tr>';
        animals.forEach(function (a) {
            table += '<tr>';
            table += '<td>' + a.nom + '</td>';
            table += '<td>' + a.sexe + '</td>';
            table += '<td>' + a.numreg + '</td>';
            table += '<td>' + a.tipus + '</td>';
            table += '<td><button  onclick="location.href=\'animalForm.html?identificador=' + a.id + '\'">Edita</button></td>';
            table += '<td><button id="' + i + '" value="' + a.id + '">Borrar</button></td>';
            table += '</tr>';
            i++;
        });
        table += '</table>';
        table += '<button id="animalForm" onclick="location.href=\'animalForm.html\'">Nuevo Animal</button>';
        table += '<button  id ="tractaments" onclick="location.href=\'tractaments.html\'">Tratamientos</button>';
        document.querySelector('#taula').innerHTML = table;
        //AÃ‘ADE EL EVENTO A LOS BOTONES DE BORRAR
        let buttons = document.querySelectorAll('button[value]');
        for (let j = 0; j < buttons.length; j++) {
            let valueButton = buttons[j].value;
            document.getElementById('' + j + '').addEventListener("click", async function () {
                let animal = await getById(valueButton);
                await confirmar(animal)
            })
        }
    })();
</script>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jsPDF.js"></script>
</body>
</html>
