<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Animales</title>
    <link rel="stylesheet" type="text/css" href="scss/animals.css">
</head>
<body>
<header><h1>VetPlus+</h1></header>
<div id="taula"></div>
<script type="module">
    import {getAnimals} from "./service/animalService.js";
    import {confirmar} from "./service/utils.js";
    import {getById} from "./service/animalService.js";


    (async function () {
        let i = 0;
        let animals = await getAnimals();
        let table = '<table>';
        table += '<tr>';
        table += '<th>Nom</th>';
        table += '<th>Sexe</th>';
        table += '<th>Numero de registre</th>';
        table += '<th>Tipus</th>';
        table += '<th>Editar</th>';
        table += '<th>Borrar</th>';
        table += '</tr>';
        animals.forEach(function (a) {
            table += '<tr>';
            table += '<td>' + a.nom + '</td>';
            table += '<td>' + a.sexe + '</td>';
            table += '<td>' + a.numreg + '</td>';
            table += '<td>' + a.tipus + '</td>';
            table += '<td><button  onclick="location.href=\'animalForm.html?identificador=' + a.id + '\'">Edita</button></td>';
            table += '<td><button id="' + i + '" value="' + a.id + '">Borrar</button></td>';
            table += '</tr>';
            i++;
        });
        table += '</table>';
        table += '<button id="animalForm" onclick="location.href=\'animalForm.html\'">Nuevo Animal</button>';
        table += '<button  id ="tractaments" onclick="location.href=\'tractaments.html\'">Tratamientos</button>';
        document.querySelector('#taula').innerHTML = table;
        //AÃ‘ADE EL EVENTO A LOS BOTONES DE BORRAR
        let buttons = document.querySelectorAll('button[value]');
        for (let j = 0; j < buttons.length; j++) {
            let valueButton = buttons[j].value;
            document.getElementById('' + j + '').addEventListener("click", async function () {
                let animal = await getById(valueButton);
                await confirmar(animal)
            })
        }
    })();
</script>
</body>
</html>
